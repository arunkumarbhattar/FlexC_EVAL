# CVE-2010-2810

## Experiment Environment

Ubuntu 14.04LTS

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2010-2810/lynx2.8.8dev.1.tar.gz
tar -xvf lynx2.8.8dev.1.tar.gz
cd lynx2-8-8/
./configure
make
```

## Problems in Installation & Configuration


## How to trigger vulnerability

```
./lynx crash.html
```

## PoCs

[Heap overflow when parsing malformed URLs](https://bugs.launchpad.net/ubuntu/+source/lynx-cur/+bug/613254)

## Vulnerability Details & Patch

### Root Cause

Lynx is vulnerable to a heap overflow when parsing malformed URLs. When Lynx attempts to URL decode hostnames using the convert_to_idna() function in WWW/Library/Implementation/HTParse.c, it mallocs() a destination buffer based on the size of the hostname. However, if a malicious website were to provide a link containing a hostname that included a % character in the last two characters, the parsing code will increment past the null byte of the hostname and continue to copy attacker-controlled contents into the too-small heap buffer. Since this is a heap overflow with attacker-controlled contents and length, with very few character restrictions, this may lead to arbitrary code execution (and winning pwn2own if it were held in 1993).

### Stack Trace

### Patch

```
--- WWW/Library/Implementation/HTParse.c.orig	2010-08-05 19:47:30.000000000 -0400
+++ WWW/Library/Implementation/HTParse.c	2010-08-05 19:48:41.000000000 -0400
@@ -268,6 +268,11 @@ static void convert_to_idna(char *host)
 	    int ch = *src++;
 
 	    if (ch == HEX_ESCAPE) {
+
+		/* Prevent an overflow */
+		if (!*(src+1) || !*(src+2)) 
+		  break;
+
 		int hi = hex_decode(*src++);
 		int lo = hex_decode(*src++);
``` 

## References
