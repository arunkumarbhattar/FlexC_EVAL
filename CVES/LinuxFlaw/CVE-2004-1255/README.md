# EDB-24984

## Experiment Environment

CentOS 6.5

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/EDB-24984/2fax304.tgz
tar -xvf 2fax304.tgz
cd 2fax-3.04/
gcc -o 2fax 2fax.c
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
./2fax 13.txt 13.tiff
```

## PoCs

[2Fax 3.0 Tab Expansion - Buffer Overflow](https://www.exploit-db.com/exploits/24984/)

## Vulnerability Details & Patch

### Root Cause

In 2fax.c, expandtabs() copies any amount of data into a 256-byte s array.

```
void    expandtabs(char *str)                   /* simple tab expansion */
{
  char  s[256];
  word  d,i,no;

  for (d=i=0; str[i]!=0; i++) {
      if (str[i]=='\t') {
          no=8-(d%8);                         /* calc no of spaces to insert */
          while (no--)  s[d++]=' ';

/*        str[i]=' ';                   /* can be done in 1 memmove & memset */
/*        if (no>1)
              memcpy(&str[i+no],&str[i+1], strlen(&str[i+1]) );
          while (--no) str[++i]=' ';   */
      } else
          s[d++]=str[i];
  } /*for*/
  s[d]=0;
  strcpy(str,s);
}
```

### Stack Trace

## References

[2fax 3.04 expandtabs overflows s buffer](http://securesoftware.list.cr.yp.to/archive/0/21)

[2fax Buffer Overflow in expandtabs() Lets Remote Users Execute Arbitrary Code](https://securitytracker.com/id/1012564)
