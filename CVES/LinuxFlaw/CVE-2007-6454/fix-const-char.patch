From ce4f3f9ff0dcbf4c6b663199545a676d49d9f385 Mon Sep 17 00:00:00 2001
From: SophieTwilight <zz1138131148zz@gmail.com>
Date: Tue, 26 Oct 2021 19:47:55 +0800
Subject: [PATCH] second

---
 core/common/Makefile.am |  2 +-
 core/common/sys.cpp     | 12 ++++++++----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/core/common/Makefile.am b/core/common/Makefile.am
index de9e9b0..573ed11 100644
--- a/core/common/Makefile.am
+++ b/core/common/Makefile.am
@@ -6,6 +6,6 @@ channel.cpp   http.cpp     inifile.cpp   ogg.cpp      servhs.cpp    sys.cpp
 html.cpp      mp3.cpp      stats.cpp     rtsp.cpp \
 icy.cpp       jis.cpp      pcp.cpp       servmgr.cpp   url.cpp
 
-libpeercastcommon_la_CPPFLAGS = -DENABLE_BINRELOC -pthread  -D__cplusplus -D_UNIX -D_REENTRANT -I../../core -I../../core/common
+libpeercastcommon_la_CPPFLAGS = -DENABLE_BINRELOC -pthread -D_UNIX -D_REENTRANT -I../../core -I../../core/common
 
 
diff --git a/core/common/sys.cpp b/core/common/sys.cpp
index 09ef0d5..8c76f3f 100644
--- a/core/common/sys.cpp
+++ b/core/common/sys.cpp
@@ -753,17 +753,21 @@ void LogBuffer::write(const char *str, TYPE t)
 // -----------------------------------
 char *getCGIarg(const char *str, const char *arg)
 {
+	const char *s;
+	char *ret;
+
 	if (!str)
 		return NULL;
 
-	char *s = strstr(str,arg);
+	s = strstr(str,arg);
+	ret = const_cast<char *>(s);
 
-	if (!s)
+	if (!ret)
 		return NULL;
 
-	s += strlen(arg);
+	ret += strlen(arg);
 
-	return s;
+	return ret;
 }
 
 // -----------------------------------
-- 
2.25.1

