# CVE-2004-2093

## Experiment Environment

Ubuntu 8.10

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2004-2093/rsync-2.5.7.tar.gz
tar -xvf rsync-2.5.7.tar.gz
cd rsync-2.5.7
./configure
make
sudo make install
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
gcc -o exploit 152.c
./exploit
# it will invoke /usr/local/bin/rsync, make sure you have make install rsync
```

## PoCs

[rsync 2.5.7 - Local Stack Overflow / Local Privilege Escalation](https://www.exploit-db.com/exploits/152/)

## Vulnerability Patch

### Root Cause

open_socket_out function in socket.c reads one environment variable - RSYNC_PROXY with unlimited length.

```
/* if we have a RSYNC_PROXY env variable then redirect our
         * connetcion via a web proxy at the given address. The format
         * is hostname:port */                                       
        h = getenv("RSYNC_PROXY");
        proxied = (h != NULL) && (*h != '\0');

        if (proxied) {
                strlcpy(buffer, h, sizeof(buffer));
		...
```

### Stack Trace

## References
