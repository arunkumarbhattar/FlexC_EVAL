# CVE-2014-8322

## Experiment Environment

Ubuntu 14.04 TLS

Kali

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2014-8322/aircrack-ng-1.2-beta3.tar.gz

tar -xvf aircrack-ng-1.2-beta3.tar.gz
cd aircrack-ng-1.2-beta3

make
```

## Problems in Installation & Configuration

```crypto.h:50:26: fatal error: openssl/hmac.h: No such file or directory```

**Solution:**  ```sudo apt-get install libssl-dev```


```/usr/bin/ld: cannot find -lnl-genl-3```

**Solution:** 

```sudo apt-get install libnl-dev```
Note: libnl-3-dev might not be suitable

## How to trigger vulnerability

```
gcc -o exploit 35018.c
./exploit 1234 ls
./aircrack-ng-1.2-beta3/src/aireplay-ng -9 127.0.0.1:1234

(-9 is the same as --test for aireplay-ng )
```

## PoCs

[Aireplay-ng 1.2 beta3 - 'tcp_test' Length Parameter Stack Overflow](https://www.exploit-db.com/exploits/35018/)

## Vulnerability Patch

### Root Cause

```
aireplay-ng.c

struct net_hdr {
    uint8_t     nh_type;
    uint32_t    nh_len;
    uint8_t     nh_data[0];
};

......

int tcp_test(const char* ip_str, const short port)
{
    unsigned char packet[1024];

    ......

    caplen = read(sock, &nh, sizeof(nh));

    ......

    len = ntohl(nh.nh_len);

    ......

    caplen = read(sock, packet, len);

    ......
}
```

### Stack Trace

```
(gdb) info stack
#0  0x41414141 in ?? ()
#1  0x41414141 in ?? ()
#2  0x41414141 in ?? ()
```

## References

[1] [Multiple vulnerabilities identified on Aircrack-ng](https://www.obrela.com/blog/article/1/multiple-vulnerabilities-identified-aircrack-ng/)
