# CVE-2007-1001

## Experiment Environment

CentOS 6.5

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2007-1001/php-5.1.6.tar.gz
tar -xvf php-5.1.6.tar.gz
cd php-5.1.6
./configure --with-gd
make
```

## Problems in Installation & Configuration


## How to trigger vulnerability

```
gcc -o poc poc.c
./poc
./sapi/cli/php poc.php
```

## PoCs

[PHP <= 5.2.1 wbmp file handling integer overflow](https://www.securityfocus.com/archive/1/464957)

[PHP GD Extension WBMP File Integer Overflow Vulnerabilities](https://www.securityfocus.com/bid/23357/exploit) misinterprete several symbols to html representation

[PHP 5.2.1 'GD' Extension - '.WBMP' File Integer Overflow](https://www.exploit-db.com/exploits/29823/) misses one poc file

## Vulnerability Patch

### Root Cause

There is an integer overflow in PHP in ext/gd/libgd/wbmp.c in the
function readwbmp. If large enough values are specified for wbmp image
height and/or width, so that width*height > 2^32, an integer overflow
occurs on the following line:

```
if ((wbmp->bitmap = (int *) safe_emalloc(wbmp->width * wbmp->height,
sizeof(int), 0)) == NULL)
```

causing the amount of memory allocated to be smaller than the amount
of data to be read, subsequently causing buffer overflow (See the DoS
PoC below).

### Stack Trace

### Patch

## References

