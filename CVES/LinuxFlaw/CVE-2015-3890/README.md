# CVE-2015-3890

## Experiment Environment

Ubuntu 14.04LTS

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2015-3890/openlitespeed-1.3.9.tgz
tar -xvf openlitespeed-1.3.9.tgz
cd openlitespeed-1.3.9
./configure
make
sudo make install
```

## Problems in Installation & Configuration

```
In file included from clientinfo.cpp:19:0:
../../src/http/iptogeo.h:24:19: fatal error: GeoIP.h: No such file or directory
 #include "GeoIP.h"
                   ^
compilation terminated
```

**Solution:**

```
sudo apt install libgeoip-dev
```


## How to trigger vulnerability

Server:

```
/usr/local/openlitespeed/bin/openlitespeed -d
```

Client:

```
gcc -o exploit exploit.c
./exploit
# Keep uafcrash in the same directory with exploit/exploit.c
```

## PoCs

[OpenLitespeed 1.3.9 - Use-After-Free (Denial of Service)](https://www.exploit-db.com/exploits/37051/)

[Name Open Litespeed Use After Free Vulnerability](https://www.security-assessment.com/files/documents/advisory/Open%20Litespeed%20Use%20After%20Free%20Vulnerability.pdf)

## Vulnerability Details & Patch

### Root Cause

By sending a crafted request, an attacker may trigger an out-of-bounds memory read, resulting in a segmentation
fault and server crash. This is due to a portion of memory being referenced by the application after being freed.
The second parameter (p) to the memmove() call (line 741, httpreq.cpp) within the HttpReq::newKeyValueBuf
method results in an out of bounds memory read when attacker submits a crafted HTTP request. This is due to the
portion of memory the ‘p’ parameter resides in being freed by a realloc() call. The reallocation is performed by the
allocate() method of the AutoBuf class. This is triggered by the call to AutoBuf’s grow() method within the
newKeyValueBuf method (line 736, httpreq.cpp).

### Stack Trace

### Patch

## References
