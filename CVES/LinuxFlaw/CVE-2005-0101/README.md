# CVE-2005-0101

## Experiment Environment

CentOS 6.5

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2005-0101/newspost-2.1.tar.gz
tar -xvf newspost-2.1.tar.gz
cd newspost-2.1
./configure
make
```

## Problems in Installation & Configuration

## How to trigger vulnerability

Client:

```
./newspost -s test -i localhost -f me@me.nl -n news.news /etc/hosts

```

Server:

```
perl -e 'print "A" x 1024;print "BBBBCCCCDDDDEEEE"'| nc -v -l -p 119
```

## PoCs

[Newspost 2.0/2.1 - Remote Buffer Overflow](https://www.exploit-db.com/exploits/25077/)

[Newspost Remote Buffer Overflow Vulnerability](https://www.securityfocus.com/bid/12418/info)

[Newspost 2.1 - 'socket_getline()' Remote Buffer Overflow (2)](https://www.exploit-db.com/exploits/785/) **cannot trigger the vulnerability**

## Vulnerability Patch

### Root Cause

> An overflow exists in the socket_getline() function. This function
> reads a string from the socket into a given array and is used by
> the nntp_get_response function.

The buggy code is:

```
        while (TRUE) {
                retval = read(sockfd, pi, 1);
                if(retval < 0)
                        ui_socket_error(errno);
                read_count += retval;
                pi++;
                if (buffer[i] == '\n')
                        break;
                i++;
        }
```

The pi array is the buffer and data is read into it until a '\n'
is received.  So to overflow the buffer one has to provide a long
string without newline characters.


### Stack Trace

### Patch

A rather simple fix would be to apply the patch below. It does the
job because all buffers handed to the socket_getline function are
STRING_BUFSIZE big.

--- base/socket.c.orig  Tue Jan 18 11:08:02 2005
+++ base/socket.c       Tue Jan 18 11:10:08 2005
@@ -126,7 +126,7 @@

        i = 0;
        pi = buffer;
-       while (TRUE) {
+       while (read_count < STRING_BUFSIZE - 1) {
                retval = read(sockfd, pi, 1);
                if(retval < 0)
                        ui_socket_error(errno);

## References

[newspost-20050114.txt](https://people.freebsd.org/~niels/issues/newspost-20050114.txt)

[Newspost "socket_getline()" Buffer Overflow](https://marc.info/?l=bugtraq&m=110746336728781&w=2)
