# CVE-2007-4060 & EDB-4243

## Experiment Environment

Debian Jessie

[DockerFile](https://github.com/mudongliang/Dockerfiles/tree/master/CVE-2007-4060)

[Docker Image](https://hub.docker.com/r/mudongliang/cve-2007-4060/)

Ubuntu 11.04

Ubuntu 14.04

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2007-4060/corehttp-0.5.3-patched.tar.gz

tar -xvf corehttp-0.5.3-patched.tar.gz;
cd corehttp/src;

make;
```

## Problems in Installation & Configuration

1. Change the absolute path in chttp.conf;
2. Use the patched version of corehttp(remove daemon mode and disable segment fault handler);

## How to trigger vulnerability

one terminal
```
/root/corehttp/src/corehttp /root/corehttp/chttp.conf
```
another terminal
```
gcc -o xcorehttp ./4243.c
/root/xcorehttp -h 127.0.0.1 -p 5555;
```

## PoCs

[CoreHTTP 0.5.3alpha (httpd) - Remote Buffer Overflow](https://www.exploit-db.com/exploits/4243/)


## Vulnerability Details & Patch

### Root Cause

```
http.c:32

        sscanf(parentsprock->buffer, "%[A-Za-z] %s%*[ \t\n]", req, url);
```

### Stack Trace
```
#0  0xb7fdccf9 in ?? ()
#1  0xb7e844ca in malloc_printerr (action=<optimized out>, 
    str=0xb7f74cd2 "free(): invalid pointer", ptr=0xbfffec60) at malloc.c:4998
#2  0xb7e851bd in _int_free (av=0xb7fbe420 <main_arena>, p=<optimized out>, 
    have_lock=0) at malloc.c:3842
#3  0x0804a67e in RemoveSprock (sprocket=0xbfffec60, 
    firstptr=0x804d11c <FIRSTSPROCK>) at sprock.c:146
#4  0x0804b4af in HttpSprockMake (parentsprock=0xbfffea60) at http.c:187
#5  0xbfffea60 in ?? ()
```



## References
