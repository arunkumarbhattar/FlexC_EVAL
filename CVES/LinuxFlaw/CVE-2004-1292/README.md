# CVE-2004-1292

## Experiment Environment

Ubuntu 11.04

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2004-1292/ringtonetools-2.22.tar.gz
tar -xvf ringtonetools-2.22.tar.gz
cd ringtonetools-2.22
make
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
./ringtonetools 31.emelody
```

## PoCs

[Ringtone Tools Buffer Overflow in parse_emelody() Lets Remote Users Execute Arbitrary Code](https://securitytracker.com/id/1012573)

[Michael Kohn Ringtone Tools EMelody File Remote Buffer Overflow Vulnerability](https://www.securityfocus.com/bid/12010/exploit)

[Michael Kohn Ringtone Tools 2.22 - '.EMelody' File Remote Buffer Overflow](https://www.exploit-db.com/exploits/25015/)

## Vulnerability Patch

### Root Cause

> In parse_emelody.c, parse_emelody() reads any amount of
> input into a 1024-byte song[] array.

### Stack Trace

```
#0  0x0000555555566ad7 in write_wav_note (out=0x555555572890, note=0x7fffffffced0) at ./src/wav.c:129
#1  0x0000555555557752 in note_route (out=0x555555572890, note=0x7fffffffced0, in_type=8, out_type=0) at ./src/fileoutput.c:177
#2  0x000055555555d6fd in parse_emelody (in=0x5555555726b0, out=0x555555572890, out_type=0, note=0x7fffffffced0) at ./src/parse_emelody.c:183
#3  0x0000555555564859 in main (argc=2, argv=0x7fffffffdcb8) at ./src/ringtonetools.c:650
```

## References
