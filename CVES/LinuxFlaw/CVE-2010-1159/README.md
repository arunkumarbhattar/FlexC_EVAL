# CVE-2010-1159

## Experiment Environment

CentOS 6.5

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2010-1159/aircrack-ng-1.0.tar.gz
tar -xvf aircrack-ng-1.0.tar.gz
cd aircrack-ng-1.0
make
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
python poc.py

or

directly download from PoCs Link #3
```

```
cd src
./aircrack-ng aircrackng_exploit.cap

or 

./airdecap-ng aircrackng_exploit.cap

or

airodump-ng -r aircrackng_exploit.cap
```

## PoCs

[Aircrack-NG Tools svn r1675 - Remote Heap Buffer Overflow (PoC)](https://www.exploit-db.com/exploits/12217/)

[Aircrack-ng EAPOL Packet Processing Buffer Overflow Vulnerability](https://www.securityfocus.com/bid/39045/exploit)

[aircrack-ng-1.1-r2: Buffer overflow (CVE-2010-1159)](https://bugs.gentoo.org/311797)

## Vulnerability Details & Patch

### Root Cause

### Stack Trace

### Patch

```
--- src/airodump-ng.c
+++ src/airodump-ng.c
@@ -2126,7 +2126,7 @@
                     st_cur->wpa.eapol_size = ( h80211[z + 2] << 8 )
                             +   h80211[z + 3] + 4;
 
-                    if ((int)pkh.len - z < st_cur->wpa.eapol_size  || st_cur->wpa.eapol_size == 0)
+                    if (caplen - z < st_cur->wpa.eapol_size  || st_cur->wpa.eapol_size == 0 || caplen - z < 81 + 16 || st_cur->wpa.eapol_size > 256)
 					{
 						// Ignore the packet trying to crash us.
                     	goto write_packet;
@@ -2158,7 +2158,7 @@
                     st_cur->wpa.eapol_size = ( h80211[z + 2] << 8 )
                             +   h80211[z + 3] + 4;
 
-                    if ((int)pkh.len - z < st_cur->wpa.eapol_size  || st_cur->wpa.eapol_size == 0)
+		    if (caplen - z < st_cur->wpa.eapol_size  || st_cur->wpa.eapol_size == 0 || caplen - z < 81 + 16 || st_cur->wpa.eapol_size > 256)
 					{
 						// Ignore the packet trying to crash us.
                     	goto write_packet;
```

## References
