# CVE-2009-2285

## Experiment Environment

Ubuntu 14.04LTS

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2009-2285/tiff-3.8.2.tar.gz
tar -xvf tiff-3.8.2.tar.gz
cd tiff-3.8.2
./configure
make
```

## Problems in Installation & Configuration


## How to trigger vulnerability

```
./tools/tiff2ps libtiff_crash/wololo.tif
```

## PoCs

[LibTIFF 3.8.2 - 'LZWDecodeCompat()' Remote Buffer Underflow](https://www.exploit-db.com/exploits/33049/)

[LibTIFF 'LZWDecodeCompat()' Remote Buffer Underflow Vulnerability](https://www.securityfocus.com/bid/35451/exploit)

[Bug 2065 - LZWDecodeCompat buffer underflow](http://bugzilla.maptools.org/show_bug.cgi?id=2065)

## Vulnerability Details & Patch

### Root Cause

### Stack Trace

### Patch

```
Index: tiff-3.8.2/libtiff/tif_lzw.c
===================================================================
--- tiff-3.8.2.orig/libtiff/tif_lzw.c
+++ tiff-3.8.2/libtiff/tif_lzw.c
@@ -421,7 +421,7 @@ LZWDecode(TIFF* tif, tidata_t op0, tsize
 			NextCode(tif, sp, bp, code, GetNextCode);
 			if (code == CODE_EOI)
 				break;
-			if (code == CODE_CLEAR) {
+			if (code >= CODE_CLEAR) {
 				TIFFErrorExt(tif->tif_clientdata, tif->tif_name,
 				"LZWDecode: Corrupted LZW table at scanline %d",
 				tif->tif_row);
@@ -624,7 +624,7 @@ LZWDecodeCompat(TIFF* tif, tidata_t op0,
 			NextCode(tif, sp, bp, code, GetNextCodeCompat);
 			if (code == CODE_EOI)
 				break;
-			if (code == CODE_CLEAR) {
+			if (code >= CODE_CLEAR) {
 				TIFFErrorExt(tif->tif_clientdata, tif->tif_name,
 				"LZWDecode: Corrupted LZW table at scanline %d",
 				tif->tif_row);
```

## References
